@model Models.Book

@{
    ViewData["Title"] = "Edit";
}



<h3 class="titlemain"> ویرایش کتاب</h3>
<div  class="row" >
    <div class="col-md-12">
        <div class="card">
            <div class="card-header" style="background-color:silver;font-size:18px;">
                    ویرایش کتاب
            </div>
            <div class="card-body">
                <form asp-action="Edit" enctype="multipart/form-data">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>


                    <div class='form-group row'>
                        <label asp-for="Name" class="control-label col-sm-2"></label>
                        <div class='col-sm-8'>
                            <input asp-for="Name" class="form-control" />
                            <span asp-validation-for="Name" class="text-danger"></span>
                        </div>
                    </div>
                    <div class='form-group row'>
                        <label asp-for="FieldOfStudyId" class="control-label col-sm-2"></label>
                        <div class='col-sm-8'>

                            <select asp-for="FieldOfStudyId" class="form-control" asp-items="ViewBag.FieldOfStudyId">
                            </select>
                            <span asp-validation-for="FieldOfStudyId" class="text-danger"></span>
                        </div>

                    </div>

                    <div class='form-group row'>
                        <label asp-for="SectionId" class="control-label col-sm-2"></label>
                        <div class='col-sm-8'>
                            <select asp-for="SectionId" class="form-control" asp-items="ViewBag.SectionId">
                            </select>
                            <span asp-validation-for="SectionId" class="text-danger"></span>
                        </div>

                    </div>
                    <div class='form-group row'>
                        <label asp-for="LessonId" class="control-label col-sm-2"></label>
                        <div class='col-sm-8'>
                            <select asp-for="LessonId" class="form-control" asp-items="ViewBag.LessonId">
                            </select>
                            <span asp-validation-for="LessonId" class="text-danger"></span>
                        </div>

                    </div>

                    @*<div class='form-group row' id="lessonname">
            <label class="control-label col-sm-2"> نام درس</label>
            <div class='col-sm-8'>
                <select id="LessonId" name="LessonId" class="form-control">
                </select>
            </div>

        </div>*@


                    <div class='form-group row'>
                        <label asp-for="Author" class="control-label col-sm-2"></label>
                        <div class='col-sm-8'>
                            <input asp-for="Author" class="form-control" />
                            <span asp-validation-for="Author" class="text-danger"></span>
                        </div>
                    </div>
                    <div class='form-group row'>
                        <label asp-for="Publisher" class="control-label col-sm-2"></label>
                        <div class='col-sm-8'>
                            <input asp-for="Publisher" class="form-control" />
                            <span asp-validation-for="Publisher" class="text-danger"></span>
                        </div>
                    </div>
                    <div class='form-group row'>
                        <label asp-for="CreateDateShamsi" class="control-label col-sm-2 "></label>
                        <div class='col-sm-8'>
                            <input asp-for="CreateDateShamsi" class="form-control" />
                            <span asp-validation-for="CreateDateShamsi" class="text-danger"></span>
                        </div>
                    </div>
                    <div class='form-group row'>
                        <label asp-for="EndCreateDateShamsi" class="control-label col-sm-2 "></label>
                        <div class='col-sm-8'>
                            <input asp-for="EndCreateDateShamsi" class="form-control" />
                            <span asp-validation-for="EndCreateDateShamsi" class="text-danger"></span>
                        </div>
                    </div>


                    <div class='form-group row'>
                        <label asp-for="ProductTypeId" class="control-label col-sm-2"></label>
                        <div class='col-sm-8'>
                            <select asp-for="ProductTypeId" class="form-control" asp-items="ViewBag.ProductTypeId"></select>
                            <span asp-validation-for="ProductTypeId" class="text-danger"></span>
                        </div>

                    </div>
                    <div class='form-group row'>
                        <label class="form-check-label col-sm-2">وضعیت</label>
                        <div class='col-sm-8'>
                            &nbsp;&nbsp;&nbsp; <input class="form-check-input" asp-for="Enable" />@Html.DisplayNameFor(model => model.Enable)
                        </div>
                    </div>
                    <div class='form-group row'>
                        <label asp-for="Cover" class="control-label col-sm-2"></label>
                        <div class='col-sm-8'>

                            <div class="col-md-12">
                                <input type="file" title="search image" id="file" class="custom-file-input" name="file" onchange="show(this)" />
                                <label class="custom-file-label" for="customFile">انتخاب جلد کتاب</label>
                            </div>

                        </div>
                    </div>

                    <div class='form-group row'>
                        <div class="control-label col-sm-2"></div>
                        <div class='col-sm-8'>
                            <div>
                                <img src="@Model.Cover" id="user_img" style="border: dashed 1px silver " height="600" width="400" />
                            </div>
                        </div>
                    </div>

                    <input type="hidden" asp-for="Id" />
                    <input type="hidden" asp-for="LessonId" />
                    <div class="form-group">
                        <input type="submit" value="ذخیره" class="btn btn-primary" />
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div>
    <a asp-action="Index">برگشت به لیست</a>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
<script>
    function show(input) {
        if (input.files && input.files[0]) {
            var filerdr = new FileReader();
            filerdr.onload = function (e) {
                $('#user_img').attr('src', e.target.result);
            }
            filerdr.readAsDataURL(input.files[0]);
        }
    }
    $(document).ready(function () {
        //var id = $('#LessonId').val();
        //  var idFileadOfStudy = $("#FieldOfStudyId").val();
        //   var idSection = $("#SectionId").val();
        //  $.ajax({

        //        type: "POST",

        //        dataType: "json",

        //        data: { idFileadOfStudy: idFileadOfStudy, idSection: idSection },

        //        url: "/Books/GetLesson",

        //        error: function (response) {
        //            alert("error");
        //        },

        //        success: function (response) {
        //            console.log(response);
        //            $.each(response, function (index, value) {
        //                alert("csdcdc");
        //                if (value['id'] == id) {
        //                  $("#lessonId").append(" <option value=" + value['id'] + ">" + value['name'] + " selected </option>");
        //                }
        //                $("#lessonId").append(" <option value=" + value['id'] + ">" + value['name'] + "</option>");
        //            });
        //        },
        //        complete: function (response) {

        //        },
        //    });

        $('#SectionId,#FieldOfStudyId').change(function () {
            var dd = $('#SectionId').parent;

            var idFileadOfStudy = $("#FieldOfStudyId").val();
            var idSection = $("#SectionId").val();

            $.ajax({

                type: "POST",

                dataType: "json",

                data: { idFileadOfStudy: idFileadOfStudy, idSection: idSection },

                url: "/Books/GetLesson",

                error: function (response) {
                    alert("error");
                },

                success: function (response) {
                      $('#LessonId')
                        .find('option')
                        .remove()
                        .end();
                    $.each(response, function (index, value) {
                        $("#LessonId").append(" <option value=" + value['id'] + ">" + value['name'] + "</option>");
                    });
                },
                complete: function (response) {

                },
            });

        });
    });
</script>
